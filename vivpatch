#!/bin/sh
cd /opt/vivaldi/resources/vivaldi/style

# Check if the css is already imported.
if cat common.css | grep -q "@import \"custom.css\";"; then
  echo "Custom Vivaldi CSS already installed."
  exit 0
fi

# Write custom.css
echo "LyogUmVtb3ZlIGhlYWRlciAqLwo6LXdlYmtpdC1hbnkoLm5hdGl2ZSwgLm1heGltaXplZCkjYnJvd3NlciAjaGVhZGVyIHsKCW1pbi1oZWlnaHQ6IDAgIWltcG9ydGFudDsKfQoKLyogS2VlcCBWaXZhbGRpIGJ1dHRvbiAqLwo6LXdlYmtpdC1hbnkoLm5hdGl2ZSwgLm1heGltaXplZCkjYnJvd3NlciAudml2YWxkaSAgewoJei1pbmRleDogMTsKfQoKLyogS2VlcCBob3Jpem9udGFsIG1lbnUgKi8KOi13ZWJraXQtYW55KC5uYXRpdmUsIC5tYXhpbWl6ZWQpI2Jyb3dzZXIgLnRvcG1lbnUgewoJcG9zaXRpb246IGFic29sdXRlOwp9CgovKiBSZWR1Y2UgdG9vbGJhciBzaXplIGZvciB2aXZpYWxkaSBidXR0b24gKi8KOi13ZWJraXQtYW55KC5uYXRpdmUsIC5tYXhpbWl6ZWQpI2Jyb3dzZXI6bm90KC50YWJzLXRvcCkgLlVybEJhci50b29sYmFyLnRvb2xiYXItbWFpbmJhci50b29sYmFyLWxhcmdlIHsKCXBhZGRpbmctbGVmdDogMjRweDsKfQoKLyogUmVkdWNlIHRvb2xiYXIgc2l6ZSBmb3IgaG9yaXpvbnRhbCBtZW51ICovCjotd2Via2l0LWFueSgubmF0aXZlLCAubWF4aW1pemVkKS5ob3Jpem9udGFsLW1lbnUjYnJvd3Nlcjpub3QoLnRhYnMtdG9wKSAuVXJsQmFyLnRvb2xiYXIudG9vbGJhci1tYWluYmFyLnRvb2xiYXItbGFyZ2UgewoJcGFkZGluZy1sZWZ0OiAyNjdweDsKfQoKLyogTm9uLU5hdGl2ZSB3aW5kb3cgZml4ZXMgKi8KCi8qIEtlZXAgd2luZG93IGJ1dHRvbnMgKi8KLm1heGltaXplZCNicm93c2VyIC53aW5kb3ctYnV0dG9uZ3JvdXAgewoJei1pbmRleDogMTsKfQoKLyogUmVkdWNlIHRvb2xiYXIgc2l6ZSBmb3Igd2luZG93IGJ1dHRvbnMgKi8KLm1heGltaXplZCNicm93c2VyOm5vdCgubmF0aXZlKTpub3QoLnRhYnMtdG9wKSAuVXJsQmFyLnRvb2xiYXIudG9vbGJhci1tYWluYmFyLnRvb2xiYXItbGFyZ2UgewoJcGFkZGluZy1yaWdodDogMTQwcHg7Cn0KCi8qIEFkanVzdCBob3Jpem9udGFsIG1lbnUgcG9zaXRpb24gKi8KLm1heGltaXplZCNicm93c2VyOm5vdCgubmF0aXZlKSAudG9wbWVudSB7CglsZWZ0OiAtMzBweDsKfQoKLyogUmVtb3ZlIHZpdmFsZGkgYnV0dG9uLCBob3Jpem9udGFsIG1lbnUgYW5kIHdpbmRvdyBidXR0b25zIHdoZW4gbm8gdWkgKi8KLm1heGltaXplZC5taW5pbWFsLXVpI2Jyb3dzZXIgOi13ZWJraXQtYW55KC52aXZhbGRpLCAudG9wbWVudSwgLndpbmRvdy1idXR0b25ncm91cCkgewoJZGlzcGxheTogbm9uZSAhaW1wb3J0YW50Owp9CgovKiBUYWJzIG9uIHRvcCBmaXhlcyAqLwoKLyogTWF4aW1pemVkIG5vdCBOYXRpdmUgLSBSZWR1Y2UgdGFiIGJhciBzaXplIGZvciBob3Jpem9udGFsIG1lbnUgYW5kIHdpbmRvdyBidXR0b25zICovCi5tYXhpbWl6ZWQuaG9yaXpvbnRhbC1tZW51I2Jyb3dzZXI6bm90KC5uYXRpdmUpICN0YWJzLWNvbnRhaW5lci50b3AgewoJcGFkZGluZy1sZWZ0OiAyNzZweCAhaW1wb3J0YW50OwoJcGFkZGluZy1yaWdodDogMTQwcHggIWltcG9ydGFudDsKfQoKLyogTmF0aXZlIC0gUmVkdWNlIHRhYiBiYXIgc2l6ZSBmb3IgaG9yaXpvbnRhbCBtZW51IGFuZCB3aW5kb3cgYnV0dG9ucyAqLwoubmF0aXZlLmhvcml6b250YWwtbWVudSNicm93c2VyICN0YWJzLWNvbnRhaW5lci50b3AgewoJcGFkZGluZy1sZWZ0OiAyNzZweCAhaW1wb3J0YW50Owp9CgojYnJvd3Nlci5uYXRpdmUubGludXggI2hlYWRlciwgI2Jyb3dzZXIubmF0aXZlLndpbiAjaGVhZGVyIHsKICAgIG1pbi1oZWlnaHQ6IDBweDsKICAgIG92ZXJmbG93OiB2aXNpYmxlOwogICAgaGVpZ2h0OiAwcHg7CiAgICB6LWluZGV4OiA1Owp9CgojYnJvd3Nlci5uYXRpdmUgI3RpdGxlYmFyIHsKICAgIHRvcDogNHB4Owp9CgojYnJvd3Nlci5uYXRpdmUgLnRvb2xiYXIudG9vbGJhci1hZGRyZXNzYmFyIHsKICAgIHBhZGRpbmctbGVmdDogMzVweDsKfQ==" | base64 -d | sudo tee custom.css > /dev/null

# Have the other css document import the custom css
echo "@import \"custom.css\";\n" | sudo tee modified.css > /dev/null
cat common.css | sudo tee --append modified.css > /dev/null
sudo mv modified.css common.css

echo "Wrote custom Vivaldi CSS."
