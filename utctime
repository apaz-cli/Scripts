#!/usr/bin/env python3

import sys
from datetime import datetime, timedelta
from zoneinfo import ZoneInfo
import re

def parse_time(time_str):
    """Parse time string like '9pm', '10am', '17' and return hour (0-23)."""
    time_str = time_str.strip().lower()
    
    match = re.match(r'^(\d{1,2})(?:\s*)(am|pm)?$', time_str)
    if not match:
        raise ValueError(f"Invalid time format: {time_str}")
    
    hour = int(match.group(1))
    ampm = match.group(2)
    
    if ampm:
        if ampm == 'pm':
            if hour != 12:
                hour += 12
        else:
            if hour == 12:
                hour = 0
    else:
        if hour < 0 or hour > 23:
            raise ValueError(f"Hour must be between 0 and 23: {hour}")
    
    return hour

def get_next_chicago_time(utc_hour):
    """Get the next time in Chicago when it will be the given UTC hour."""
    utc_tz = ZoneInfo('UTC')
    chicago_tz = ZoneInfo('America/Chicago')
    
    now = datetime.now(utc_tz)
    target_utc = now.replace(hour=utc_hour, minute=0, second=0, microsecond=0)
    
    if target_utc <= now:
        target_utc += timedelta(days=1)
    
    chicago_time = target_utc.astimezone(chicago_tz)
    return chicago_time

def main():
    if len(sys.argv) != 2:
        print("Usage: utctime <hour>", file=sys.stderr)
        print("  hour: time in UTC (e.g., '9pm', '10am', '17')", file=sys.stderr)
        sys.exit(1)
    
    try:
        utc_hour = parse_time(sys.argv[1])
        chicago_time = get_next_chicago_time(utc_hour)
        print(chicago_time.strftime('%Y-%m-%d %I:%M %p %Z'))
    except ValueError as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)

if __name__ == '__main__':
    main()
